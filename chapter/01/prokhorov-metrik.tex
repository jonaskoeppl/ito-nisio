\section{Die Prokhorov Metrik}
Nachdem wir im letzten Abschnitt damit begonnen haben Folgen von Wahrscheinlichkeitsmaßen auf schwache Konvergenz zu untersuchen wollen wir im Folgenden ein weiteres wichtiges Hilfsmittel für dieses Unterfangen besprechen.
Zunächst einmal sei dafür an den Begriff der relativen Kompaktheit erinnert. 
\begin{mydef}
    Eine Teilmenge $A$ eines metrischen Raums $(X,d)$ heißt \textit{relativ kompakt}, falls ihr Abschluss $\overline{A}$ kompakt ist. 
\end{mydef}
Mittels der Teilfolgencharakterisierung von kompakten Teilmengen metrischer Räume erhält man unmittelbar

\begin{proposition}
    Eine Teilmenge $A$ eines metrischen Raums $(X,d)$ ist genau dann relativ kompakt, wenn jede Folge $(x_n)_{n \in \N}$ in $A$ eine in $\overline{A}$ konvergente Teilfolge enthält.
\end{proposition}
Eine Folge $(x_n)_{n \in \N}$ in einem metrischen Raum konvergiert also genau dann, wenn die beiden folgenden Bedingungen erfüllt sind
\begin{enumerate}[(i)]
    \item Die Menge $\{x_n : n \in \N \}$ ist relativ kompakt und
    \item alle konvergenten Teilfolgen von $(x_n)_{n \in \N}$ haben den selben Grenzwert. 
\end{enumerate}

Ziel dieses Abschnitts ist es daher zunächst eine adäquate Metrik zu konstruieren, die die schwache Konvergenz von Wahrscheinlichkeitsmaßen beschreibt. 
Anschließend wollen wir den Begriff der relativen Kompaktheit bzgl. dieser Metrik charakterisieren. 
\newline \ \newline
Für einen metrischen Raum $(X,d)$ bezeichne $\mathcal{M}(X)$ die Menge aller Wahrscheinlichkeitsmaße auf der Borelschen $\sigma$-Algebra $\mathcal{B}(X)$ und für eine Menge $B \in \mathcal{B}(X)$ definiere für $\varepsilon > 0$
$$
    B^{\varepsilon} = \begin{cases}
         \{x \in X: \inf_{y \in B}d(x,y) < \varepsilon\}, \text{ falls } B \neq \emptyset, \\\ 
        \emptyset, \text{ sonst.}
    \end{cases}
$$
Betrachte nun die Abbildung 
$$
    \rho: \mathcal{M}(X) \times \mathcal{M}(X) \to [0, \infty),
$$
definiert durch
$$
    (\mu, \nu) \mapsto \inf\{\alpha > 0 | \forall B \in \mathcal{B}(X): \mu(B) \leq \nu(B^{\alpha}) + \alpha \ \land \ \nu(B) \leq \mu(B^{\alpha}) + \alpha \}.
$$

\begin{proposition}
    \begin{enumerate}[(i)]
        \item Die Abbildung $\rho$ ist wohldefiniert und eine Metrik auf $\mathcal{M}(X)$. 
        \item Für $\alpha > 0$ und $\mu, \nu \in \mathcal{M}(X)$ gilt
        $$
            (\forall B \in \mathcal{B}(X): \ \mu(B) \leq \nu(B^{\alpha}) + \alpha) \Rightarrow (\forall B \in \mathcal{B}(X): \ \nu(B) \leq \mu(B^{\alpha}) + \alpha).
        $$
        \item Für $\mu, \mu_1, \mu_2,... \in \mathcal{M}(X)$ gilt 
        $$
            \lim_{n \to \infty} \rho(\mu_n, \mu) = 0 \ \Rightarrow \ \mu_n \rightharpoonup \mu 
        $$
    \end{enumerate}
\end{proposition}

\begin{proof*}
    zu $(i)$: Die Menge ist nicht leer, da die Bedingung für alle $\alpha \geq 1$ erfüllt ist. Offensichtlich gilt ferner $\rho(\mu, \nu) \geq 0$ und $\rho(\mu, \nu) = \rho(\nu, \mu)$. 
    Wegen $B \subseteq B^{\alpha}$ für alle $B \in \mathcal{B}(X)$ und $\alpha > 0$ gilt 
    $$
        \forall B \in \mathcal{B} \ \forall \alpha > 0: \quad \mu(A) \leq \mu(A^{\alpha}) + \alpha.
    $$
    Also gilt $\rho(\mu, \mu) = 0$. Gilt andererseits $\rho(\mu, \nu) = 0$, so existiert eine Folge $(\alpha_n)_{n \in \N}$ mit $\alpha_n \downarrow 0$ und
    $$
    \forall B \in \mathcal{B} \ \forall n \in \N: \quad \mu(A) \leq \nu(A^{\alpha_n}) + \alpha_n \quad \land \nu(A) \leq \mu(A^{\alpha_n}) + \alpha_n.
    $$
    Insbesondere gilt für alle abgeschlossenen Mengen $A \subseteq X$, dass $A^{\alpha_n} \downarrow A$ und daher
    $$
        \mu(A) = \lim_{n \to \infty} \mu(A^{\alpha_n}) + \alpha_n \geq \nu(\alpha) = \lim_{n \to \infty} \nu(A^{\alpha_n}) + \alpha_n \geq \mu(\alpha). 
    $$
    Da die abgeschlossenen Mengen ein schnittstabiler Erzeuger von $\mathcal{B}(X)$ sind folgt somit $\mu = \nu$.
    \newline
    \textit{zur Dreiecksungleichung:} Seien $\mu, \nu, \eta \in \mathcal{M}(X)$ und $\alpha, \beta > 0$ mit 
    \begin{align*}
        \forall B \in \mathcal{B}(X): \quad &\mu(A) \leq \eta(A^{\alpha}) + \alpha \quad \land \quad \eta(A) \leq \mu(A^{\alpha}) + \alpha, \\\
                                            &\nu(A) \leq \eta(A^{\beta}) + \beta \quad \land \quad \eta(A) \leq \nu(A^{\beta}) + \beta.
    \end{align*}
    Dann gilt für $A \in \mathcal{B}(X)$
    \begin{align*}
        &\mu(A) \leq \eta(A^{\alpha}) + \alpha \leq \nu((A^{\alpha})^{\beta}) + \alpha + \beta, \\\
        &\nu(A) \leq \eta(A^{\beta}) + \beta \leq \mu((A^{\alpha})^{\beta}) + \alpha + \beta. 
    \end{align*}
    Nach der Dreiecksungleichung für $d$ gilt $(A^{\alpha})^{\beta} \subseteq A^{\alpha + \beta}$ und $(A^{\beta})^{\alpha} \subseteq A^{\alpha + \beta}$. Also ergibt sich mit obigem $\rho(\mu, \nu) \leq \alpha + \beta$. 
    Bilden der Infima auf der rechten Seite liefert
    $$
        \rho(\mu, \nu) \leq \rho(\mu, \eta) + \rho(\eta, \nu).
    $$
    zu $(ii)$: Sei $\alpha > 0$ mit 
    $$
        \forall B \in \mathcal{B}(X): \ \mu(B) \leq \nu(B^{\alpha}) + \alpha.
    $$
    Für zwei Mengen $A,B \in \mathcal{B}(X)$ gilt nach Definition $A \subseteq (B^{\alpha})^c$ genau dann, wenn $B \subseteq (A^{\alpha})^c$. 
    Zu $B \in \mathcal{B}(X)$ setze also $A:=(A^{\alpha})^c$ und erhalte 
    $$ 
        \mu(B^{\alpha}) = 1 - \mu(A) \geq 1 - \nu(A^{\alpha}) - \alpha = \nu((A^{\alpha})^c) - \alpha \geq \nu(B) - \alpha. 
    $$
    zu $(iii)$: Wegen $\rho(\mu_n, \mu) \to 0$ existiert eine Folge $(\alpha_n)_{n \in \N}$ mit $\alpha_n \downarrow 0$ und 
    $$
        \forall n \in \N \ \forall B \in \mathcal{B}(X): \quad \mu_n(B) \leq \mu(B^{\alpha_n}) + \alpha_n. 
    $$
    Sei nun $A \subseteq X$ abgeschlossen. Dann gilt $A^{\alpha_n} \downarrow A$ und folglich
    $$
        \limsup_{n \to \infty} \mu_n(A) \leq \limsup_{n \to \infty} \mu(A^{\alpha_n}) + \alpha_n = \lim_{n \to \infty} \mu(A^{\alpha_n}) = \mu(A). 
    $$
    Nach dem Portmanteau-Theorem gilt also $\mu_n \rightharpoonup \mu$. 
    \qed
\end{proof*}
Falls der zugrunde liegende metrische Raum separabel ist, so gilt auch die Umkehrung von $(ii)$. Zum Beweis dieser Tatsache benötigen wir zunächst das folgende technische Lemma. 
\begin{lemma}
    Sei $X$ ein separabler metrischer Raum und $\mu$ ein Wahrscheinlichkeitsmaß auf $\mathcal{B}(X)$. Dann existiert für alle $\delta > 0$ eine Folge $(x_n)_{n \in \N}$ in $X$ und eine Folge $(r_n)_{n \in \N}$ in $(0, \delta)$ mit 
         $$
         X = \bigcap_{n=1}^{\infty}B(x_n, r_n) \ \text{ und } \ \mu(\partial B(x_n, r_n)) = 0 \text{ für alle }n \in \N.
         $$  
\end{lemma}
\begin{proof*}%TODO: überarbeiten, schöner aufschreiben. 
    Sei $D = \{x_1, x_2,... \} \subseteq X$ eine abzählbare dichte Teilmenge von $X$ und $x_n \in D$. Setze 
    $$
        S(x_n,r) = \{y \in X: d(x_n,y) = r\}.
    $$
    Dann gilt $\partial B(x_n,r) \subseteq S(x_n,r)$ und für gegebenes $\delta > 0$ ist die Mengenfamilie
    $$
        \mathcal{S}_n := \{S(x_n,r) : \frac{\delta}{2} < r < \delta \}
    $$
    disjunkt und überabzählbar. Da $\mu$ ein Wahrscheinlichkeitsmaß ist enthält $\mathcal{S}_n$ aber höchstens abzählbar viele Mengen $S$ mit $\mu(S) > 0$. 
    Also existiert insbesondere ein $r_n \in (\frac{\delta}{2}, \delta)$ mit $\mu(S(x_n,r_n)) = 0$. Da $D$ dicht in $X$ ist gilt 
    $$
        X \subseteq \bigcup_{n \in  \N}B(x_n, r_n)
    $$
    und folglich erfüllen $(x_n)_{n \in \N}$ und $(r_n)_{n \in \N}$ die geforderten Bedingungen. \qed
\end{proof*}

\begin{theorem}
    Sei $(X,d)$ ein separabler metrischer Raum. Dann gilt für $\mu, \mu_1, \mu_2, ... \in \mathcal{M}(X)$
    $$
        \lim_{n \to \infty} \rho(\mu_n, \mu) = 0 \ \iff \ \mu_n \rightharpoonup \mu 
    $$
\end{theorem}

\begin{proof*}
    zu $\Rightarrow$: Siehe Proposition $1.16(iii)$.
    \newline 
    zu $\Leftarrow$:  Wir zeigen
    $$
        \forall \varepsilon > 0 \ \exists N \in \N \ \forall n \geq N: \quad \forall B \in \mathcal{B}: \  \mu(B) \leq \mu_n(B^{\varepsilon}) + \varepsilon. 
    $$
    Daraus folgt nach Proposition $1.16(ii)$ die Behauptung. Sei $\delta := \frac{\varepsilon}{4} > 0$. 
    Dann existiert nach vorherigem Lemma eine Folge $(B_n)_{n \in \N}) := (B(x_n, r_n))_{n \in \N}$ offener Kugeln mit Radius $r_n < \frac{\delta}{2}$  
    und $\mu(\partial B_n) = 0$ für alle $n \in \N$, sowie $X = \cup_{n \in  \N}B_n$. Ferner existiert $k \in N$ mit
    $$
        \mu\left(\bigcup_{i=1}^k B_i\right) \geq 1 - \delta. 
    $$
    Betrachte nun das endliche Mengensystem 
    $$
        \mathcal{C} := \left\{ \bigcup_{j \in J}B_j : J \subseteq \{1,..,k\}\right\}. 
    $$
    Dann gilt für alle $A \in \mathcal{C}$
    $$
        \partial A \subseteq \bigcup_{i=1}^k \partial B_i,
    $$
    also $\mu(\partial A) = 0$. Nach dem Portmanteau-Theorem gilt also $\mu_n(A) \to \mu(A)$ für alle $A \in \mathcal{C}$. Da $\mathcal{C}$ endlich ist existiert daher $N \in \N$ mit
    \begin{align}
        \forall n \geq N \ \forall A \in \mathcal{A}: \quad \abs{\mu(A) - \mu_n(A)} < \delta. 
    \end{align}
    Insbesondere gilt also
    $$
        \forall n \geq N: \quad \mu_n\left(\bigcup_{i=1}^k B_i\right) \geq \mu\left(\bigcup_{i=1}^k B_i\right) - \delta \geq 1 - 2\delta. 
    $$
    Zu $B \in \mathcal{B}$ betrachte die Menge 
    $$
        A := \bigcup_{j \in J} B_j,
    $$
    wobei $J := \{j \in \{1,..k\}: B_j \cap B \neq 0 \}$. Dann ergibt sich unter Verwendung von $A \subseteq B^{\delta} \subseteq B^{\varepsilon}$ und $(1.1)$ für alle $n \geq N$ 
    $$
        \mu(B) \leq \mu(A) + \mu\left((\cup_{i=1}^k B_i)^c\right) \leq \mu(A) + 2\delta \leq \mu_n + 3\delta \leq \mu_n(B^{\varepsilon}) + \varepsilon. 
    $$
    \qed
    
\end{proof*}
Nachdem wir nun eine passende Metrik gefunden haben, um die schwache Konvergenz von Wahrscheinlichkeitsmaßen in $\mathcal{M}(X)$ zu beschreiben wollen wir nun noch kurz auf ein Resultat von Prokhorov eingehen, 
welches uns eine äußerst nützliche Charakterisierung der relativ kompakten Teilmengen von $(\mathcal{M}(X), \rho)$ liefert. 
Dazu benötigen wir die folgende 
\begin{mydef}
    Eine Familie $M \subseteq \mathcal{M}(X)$ von Wahrscheinlichkeitsmaßen heißt \textit{gleichmäßig straff}, 
    falls es für alle $\varepsilon > 0$ eine kompakte Menge $K \subseteq X$ gibt mit 
    $$
        \forall \mu \in M: \mu(K) \geq 1-\varepsilon. 
    $$
\end{mydef}

Mittels des Begriffs der gleichmäßigen Straffheit lässt sich die relative Kompaktheit von Teilmengen von $\mathcal{M}(X)$ für einen vollständigen und separablen metrischen Raum $X$ wie folgt charakterisieren. Ein Beweis findet sich etwa in \cite{parthasarathy}[Theorem 6.7]. 

\begin{theorem}[Satz von Prokhorov]
    Sei $(X,d)$ ein vollständiger separabler metrischer Raum und $M \subseteq \mathcal{M}(X)$. Dann sind äquivalent
    \begin{enumerate}[(i)]
        \item $M$ ist relativ kompakt,
        \item $M$ ist gleichmäßig straff. 
    \end{enumerate}
\end{theorem}

Um die schwache Konvergenz einer Folge $(\mu_n)_{n \in \N}$ von Wahrscheinlichkeitsmaßen zu zeigen ist es in einem vollständigen und separablen metrischen Raum also ausreichend die folgenden beiden Bedingungen zu prüfen
\begin{enumerate}[(a)]
    \item $\{\mu_n: n \in \N\}$ ist gleichmäßig straff und
    \item jede konvergente Teilfolge von $(\mu_n)_{n \in \N}$ konvergiert gegen den selben Grenzwert.
\end{enumerate}

\begin{remark}
    In \cite{li-queffelec} findet sich ein alternativer Zugang zur Prokhorov-Metrik. Hier wird die Metrik auf $\mathcal{M}(X)$ nicht wie hier über die Mengen aus $\mathcal{B}(X)$ definiert, sondern über Funktionen $f \in C_b(\R)$.
    Es wird dort gezeigt, dass es für einen vollständigen und separablen metrischen Raum $(X,d)$ eine Folge $(f_n)_{n \in \N}$ in der Einheitskugel von $C_b(\R)$ gibt, sodass durch
    $$
        (\mu, \nu) \mapsto \sum_{n=1}^{\infty}\frac{1}{2^n}\abs{\int_Xf_nd\mu - \int_X f_n d\nu}, \quad \mu, \nu \in \mathcal{M}(X)
    $$
    eine Metrik definiert ist, die die schwache Konvergenz charakterisiert. 
\end{remark}
